{% load static %}
<!doctype html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Ú©Ø§ÙÙ‡ Ø¯Ù†Ø¬ | Ù…Ù†ÙˆÛŒ Ø¯ÛŒØ¬ÛŒØªØ§Ù„</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="{% static 'css/main.css' %}" />
  </head>
  <body style="background-color: #000;">

    <div class="cafe-navbar sticky-top" style="background: rgba(0, 0, 0, 0.95); border-bottom: 1px solid #1a1a1a;">
      <div class="container text-center py-3">
        <h1 class="text-gradient h4 mb-3" style="font-weight: 800;">â˜• Ù…Ù†ÙˆÛŒ Ú©Ø§ÙÙ‡ Ø¯Ù†Ø¬</h1>
        <div class="d-flex gap-2 overflow-auto no-scrollbar pb-2">
          {% for category in categories %}
          <a href="#cat-{{ category.id }}" class="badge category-link text-decoration-none px-3 py-2" style="background: #111; border: 1px solid #222; color: #c49a6c;">
            {{ category.name }}
          </a>
          {% endfor %}
        </div>
      </div>
    </div>

    <form method="POST" action="{% url 'submit_order' %}" class="container mt-4 mb-5 pb-5">
      {% csrf_token %} 
      
      {% for category in categories %}
      <div id="cat-{{ category.id }}" class="mb-4">
        <h2 class="h6 mb-3 px-2" style="color: #c49a6c; border-right: 3px solid #c49a6c; padding-right: 10px;">
             {{ category.name }}
        </h2>

        <div class="row g-3">
          {% for item in category.items.all %}
          <div class="col-12 col-md-6">
            <div class="menu-card-pro-v4 reveal-scale" id="card-{{ item.id }}">
              
              <div class="content-section">
                <div>
                  <div class="fw-bold" style="color: #c49a6c; font-size: 1.1rem;">{{ item.name }}</div>
                  {% if item.subtitle %}
                    <div class="opacity-50 mt-1" style="font-size: 0.7rem;">{{ item.subtitle }}</div>
                  {% endif %}
                </div>
                <div class="fw-bold" style="color: #ffffff;">
                  {{ item.price }} <small style="font-size: 0.6rem; opacity: 0.6;">ØªÙˆÙ…Ø§Ù†</small>
                </div>
              </div>

              <div class="action-section">
                <div class="img-wrapper">
                    <img src="{% if item.image %}{{ item.image.url }}{% else %}https://via.placeholder.com/150{% endif %}"
                         class="img-small-rounded" alt="{{ item.name }}" />
                </div>

                <div class="v-control-bar">
                  <button type="button" class="v-btn-action" onclick="changeQty('{{ item.id }}', 1)">+</button>
                  <div class="v-counter-box">
                    <span id="qty-text-{{ item.id }}" style="font-family: monospace;">0</span>
                  </div>
                  <button type="button" class="v-btn-action" onclick="changeQty('{{ item.id }}', -1)">-</button>
                </div>
              </div>

              <input type="number" id="qty-{{ item.id }}" name="quantity_{{ item.id }}" value="0" style="display: none" />
              <input type="checkbox" name="items" value="{{ item.id }}" id="check-{{ item.id }}" style="display: none" />
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endfor %}

      <div class="fixed-bottom p-3" style="background: #000; border-top: 1px solid #c49a6c;">
        <div class="container">
          <button type="button" class="btn w-100 py-3 fw-bold"
            style="background: #c49a6c; color: #000; border-radius: 12px;"
            data-bs-toggle="modal" data-bs-target="#orderModal">
            ğŸ›’ ØªÚ©Ù…ÛŒÙ„ Ùˆ Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´
          </button>
        </div>
      </div>

      <div class="modal fade" id="orderModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content" style="background: #111; border: 1px solid #c49a6c; color: white;">
            <div class="modal-body text-center p-5">
              <h5 class="mb-4">Ø´Ù…Ø§Ø±Ù‡ Ù…ÛŒØ²ØŸ</h5>
              <input type="number" name="table_number" class="form-control form-control-lg text-center mx-auto mb-4"
                style="width: 100px; background: #000; border: 1px solid #c49a6c; color: #fff; font-size: 2rem;" required />
              <button type="submit" class="btn w-100 py-3 fw-bold" style="background: #c49a6c; color: #000;">Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´</button>
            </div>
          </div>
        </div>
      </div>
    </form>

    <script>
      function changeQty(itemId, delta) {
        const input = document.getElementById("qty-" + itemId);
        const textDisplay = document.getElementById("qty-text-" + itemId);
        const checkbox = document.getElementById("check-" + itemId);
        const card = document.getElementById("card-" + itemId);
        
        let val = parseInt(input.value) + delta;
        if (val < 0) val = 0;
        
        input.value = val;
        textDisplay.innerText = val;
        checkbox.checked = val > 0;

        // ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø¨ØµØ±ÛŒ Ú©Ø§Ø±Øª
        if (val > 0) {
            card.classList.add('active-item');
        } else {
            card.classList.remove('active-item');
        }
      }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>